<!DOCTYPE html>
<html>

<head>
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="http://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
        crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp"
        crossorigin="anonymous">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
        crossorigin="anonymous"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.16/css/jquery.dataTables.css">
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mouse0270-bootstrap-notify/3.1.7/bootstrap-notify.js"></script>
    <style>
        body,
        html {
            overflow: hidden
        }

        .myaddress {
            width: 800px !important;
        }

        .OperationsSectionDiv {
            margin: 20px;
        }

        .documenttextarea {
            width: 90%;
            height: 150px;
        }

        .navbarissue {
            background: lavender;
            width: 90%;
        }

        .issuetodiv {
            width: 90%;
        }

        .transactionsharetxtbx {
            width: 90%;
        }

        .profileimage {
            height: 150px;
            width: 150px;
            float: right;
            margin-right: 100px;
        }

        .GetTransData {
            margin: 20px;
        }

        .getdocumenttextarea {
            height: 70px;
            margin: 25px;
            width: 600px;
        }
        .validationrow{
            background: lightblue;
            margin: 25px;
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-inverse">
        <div class="container-fluid">
            <div class="navbar-header">
                <a class="navbar-brand" href="#">Viktor</a>
            </div>
            <div class="input-group">
                <form class="navbar-form navbar-right">
                    <input type="text" class="form-control myaddress" placeholder="My Address" id="myaddress" name="myaddress">
                </form>
                <span class="input-group-btn">
                    <button type="button" class="btn btn-default btn-default" onclick="CopyMyAddress()">Copy Address</button>
                </span>
            </div>
        </div>
    </nav>
    <div class="row">
        <div class="col-sm-4">
            <div class="input-group">
                <input type="text" class="form-control" id="passphrasetxtbox" placeholder="Enter The Passphrase">
                <span class="input-group-btn">
                    <button type="button" class="btn btn-default btn-default" onclick="GetKeyPair()">Generate Address & Keys</button>
                </span>
            </div>
        </div>
        <div class="col-sm-4"></div>
        <div class="col-sm-4">
            <img class="profileimage" src="https://i.pinimg.com/236x/62/e6/74/62e67418237a2854aabc1eb7563b54b7--tom-hanks-movie-stars.jpg">
        </div>
    </div>
    <div class="OperationsSectionDiv">
        <div class="row">
            <div id="issuediv" class="col-sm-6">
                <nav class="navbar navbar-light navbarissue">
                    <div class="container-fluid">
                        <div class="navbar-header">
                            <a class="navbar-brand" href="#">Issue Document</a>
                        </div>
                    </div>
                </nav>
                <textarea class="documenttextarea" rows="3" id="document" placeholder="Enter your document data" required></textarea>
                </br>
                <div class="input-group issuetodiv">
                    <input type="text" class="form-control" id="issuetoaddress" placeholder="To Address">
                    <span class="input-group-btn">
                        <button type="button" class="btn btn-default btn-default" onclick="IssueDocument()">Issue Document</button>
                    </span>
                </div>
            </div>
            <div id="sharediv" class="col-sm-6">
                <nav class="navbar navbar-light navbarissue">
                    <div class="container-fluid">
                        <div class="navbar-header">
                            <a class="navbar-brand" href="#">Share Document</a>
                        </div>
                    </div>
                </nav>
                <input type="text" class="form-control transactionsharetxtbx" id="sharetransaction" placeholder="Transaction to share">
                </br>
                <div class="input-group issuetodiv">
                    <input type="text" class="form-control" id="sharetoaddress" placeholder="To Address">
                    <span class="input-group-btn">
                        <button type="button" class="btn btn-default btn-default" onclick="ShareDocument()">Share Document</button>
                    </span>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-6">
            <div class="IssuedTransactions">
                <table id="IssuedTransactions" class="display" width="100%">
                    <thead>
                        <tr>
                            <th>Transaction ID</th>
                            <th>To Address</th>
                            <th>Is Shared</th>
                            <th>Time Stamp</th>
                        </tr>
                    </thead>
                </table>
            </div>
        </div>
        <div class="col-sm-6">
            <div class="SharedTransactions">
                <table id="SharedTransactions" class="display" width="100%">
                    <thead>
                        <tr>
                            <th>Transaction ID</th>
                            <th>From Address</th>
                            <th>Is Shared</th>
                            <th>Time Stamp</th>
                        </tr>
                    </thead>
                </table>
            </div>
        </div>
    </div>
    <div class="row validationrow">
        <div class="col-sm-2 GetTransData">
                <input type="text" class="form-control" id="passphrase" placeholder="Enter Passphrase">
        </div>
        <div class="col-sm-4 GetTransData">
            <div class="input-group">
                <input type="text" class="form-control" id="transid" placeholder="Enter Transaction ID">
                <span class="input-group-btn">
                    <button type="button" class="btn btn-default btn-default" onclick="GetTransactionData()">Get Document</button>
                </span>
            </div>
        </div>
        <div col-sm-4>
            <textarea class="getdocumenttextarea" rows="3" id="getdocument" placeholder=""></textarea>
        </div>
    </div>
</body>

</html>

<script>
    $(function () {
        IssuedTransactionGridSetup();
        SharedTransactionGridSetup();
        var tid = setInterval(ReloadIssuedTransactionGrid, 2000);
        var tid = setInterval(ReloadSharedTransactionGrid, 2000);
    });

    function GetKeyPair() {
        var passphrase = $('#passphrasetxtbox').val();
        if (passphrase) {
            $.get("http://localhost:3000/GetKeyPair?passphrase=" + passphrase, function (result) {
                $('#myaddress').val(result);
                $.notify({ message: 'Address Generated' }, { type: 'info' });
            });
        }
        else
            $.notify({ message: 'Please Enter Passphrase' }, { type: 'danger' });

    }

    function GetIssuedTransactions() {
        var FromAdd = $('#myaddress').val();
        $.get("http://localhost:3000/GetIssuedTransactions?fromadd=" + btoa(FromAdd), function (result) {
            console.log(result);
        });
    }

    function GetSharedTransactions() {
        var toadd = $('#myaddress').val();
        $.get("http://localhost:3000/GetSharedTransactions?toadd=" + btoa(ToAdd), function (result) {
            console.log(result);
        });
    }

    function ShareDocument() {
        var queryparameters = {};
        if (!$('#myaddress').val()) {
            $.notify({ message: 'Please enter From Address' }, { type: 'danger' });
        }
        else if (!$('#sharetoaddress').val()) {
            $.notify({ message: 'Please enter To Address' }, { type: 'danger' });
        }
        else if (!$('#sharetransaction').val()) {
            $.notify({ message: 'Please enter Transaction ID' }, { type: 'danger' });
        }

        else if (!$('#passphrasetxtbox').val()) {
            $.notify({ message: 'Please enter Passphrase' }, { type: 'danger' });
        }
        else {
            queryparameters.fromadd = btoa($('#myaddress').val());
            queryparameters.toadd = btoa($('#sharetoaddress').val());
            queryparameters.transid = btoa($('#sharetransaction').val());
            queryparameters.unlockkey = btoa($('#passphrasetxtbox').val());
            $.get("http://localhost:3000/SHARE?" + $.param(queryparameters), function (result) {
                console.log(result);
            });
        }
    }

    function IssueDocument() {
        var queryparameters = {};
        if (!$('#myaddress').val()) {
            $.notify({ message: 'Please enter From Address' }, { type: 'danger' });
        }
        else if (!$('#issuetoaddress').val()) {
            $.notify({ message: 'Please enter To Address' }, { type: 'danger' });
        }
        else if (!$('#document').val()) {
            $.notify({ message: 'Please enter Document Text' }, { type: 'danger' });
        }

        else {
            queryparameters.fromadd = btoa($('#myaddress').val());
            queryparameters.toadd = btoa($('#issuetoaddress').val());
            queryparameters.document = btoa($('#document').val());
            $.get("http://localhost:3000/ISSUE?" + $.param(queryparameters), function (result) {
                console.log(result);
            });
        }
    }

    function IssuedTransactionGridSetup() {
        issuedtransactiongridtable = $('#IssuedTransactions').DataTable({
            "scrollY": "20vh",
            "scrollCollapse": false,
            "paging": false,
            "searching": false,
            "ajax": {
                "url": "http://localhost:3000/GetIssuedTransactions?fromadd=" + btoa($('#myaddress').val()),
                "dataSrc": ""
            },
            "columns": [
                {
                    "data": "transactionid",
                    "render": function (data, type, row) {
                        return type === 'display' && data.length > 36 ?
                            data.substr(0, 36) + '…' :
                            data;
                    }
                },
                {
                    "data": "toaddress",
                    "render": function (data, type, row) {
                        return type === 'display' && data.length > 25 ?
                            data.substr(0, 25) + '…' :
                            data;
                    }
                },
                {
                    "data": "isshared",
                },
                {
                    "data": "timestamp",
                    "render": function (data) {
                        return new Date(data).toLocaleString();;
                    }
                }
            ]
        });
    }

    function ReloadIssuedTransactionGrid() {
        var queryparameters = {};
        issuedtransactiongridtable.ajax.url("http://localhost:3000/GetIssuedTransactions?fromadd=" + btoa($('#myaddress').val())).load();
    }

    function SharedTransactionGridSetup() {
        sharedtransactiongridtable = $('#SharedTransactions').DataTable({
            "scrollY": "20vh",
            "scrollCollapse": false,
            "paging": false,
            "searching": false,
            "ajax": {
                "url": "http://localhost:3000/GetSharedTransactions?toadd=" + btoa($('#myaddress').val()),
                "dataSrc": ""
            },
            "columns": [
                {
                    "data": "transactionid",
                    "render": function (data, type, row) {
                        return type === 'display' && data.length > 36 ?
                            data.substr(0, 36) + '…' :
                            data;
                    }
                },
                {
                    "data": "fromaddress",
                    "render": function (data, type, row) {
                        return type === 'display' && data.length > 25 ?
                            data.substr(0, 25) + '…' :
                            data;
                    }
                },
                {
                    "data": "isshared",
                },
                {
                    "data": "timestamp",
                    "render": function (data) {
                        return new Date(data).toLocaleString();;
                    }
                }
            ]
        });
    }

    function GetTransactionData() {
        var queryparameters = {};
        queryparameters.TransactionID = $('#transid').val();
        queryparameters.PassPhrase = $('#passphrase').val();
        $.get("http://localhost:3000/GetDecryptedTransactionData?" + $.param(queryparameters), function (result) {
            $('#getdocument').val(result);
            console.log(result);
        });
    }

    function ReloadSharedTransactionGrid() {
        var queryparameters = {};
        sharedtransactiongridtable.ajax.url("http://localhost:3000/GetSharedTransactions?toadd=" + btoa($('#myaddress').val())).load();
    }

    function CopyMyAddress() {
        var copyText = document.getElementById("myaddress");
        copyText.select();
        document.execCommand("copy");
        $.notify({ message: 'Address Copied' }, { type: 'info' });
    }
</script>